set init
#set log /dev/stdout

set httpd port 2812 and
    use address localhost  # only accept connection from localhost (drop if you use M/Monit)
    allow localhost        # allow localhost to connect to the server and
    allow admin:monit      # require user 'admin' with password 'monit'
    #with ssl {            # enable SSL/TLS and set path to server certificate
    #    pemfile: /etc/ssl/certs/monit.pem
    #}

check process qemu_opnsense with pidfile /var/run/qemu-opnsense.pid
  start program = "/opt/qemu-opnsense/start.sh" with timeout 300 seconds
  stop program = "/opt/qemu-opnsense/stop.sh"
  depend if_tap0
  depend opnsense_log_dir

check directory opnsense_log_dir path /var/log/qemu-opnsense
  start program = "/bin/mkdir -p /var/log/qemu-opnsense"

check network if_tap0 with interface tap0
  start program = "/bin/sh -c '/usr/sbin/ip tuntap add tap0 mode tap;/usr/sbin/ip link set tap0 master br-opnsense-lan up'"
  if link down then restart
  depend if_br_opnsense_lan

check network if_br_opnsense_lan with interface br-opnsense-lan
  start program = "/bin/sh -c '/usr/sbin/ip link add br-opnsense-lan type bridge;/usr/sbin/ip link set br-opnsense-lan up'"
  if link down then restart
